<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.resto.shop.web.dao.OrderMapper">
  <resultMap id="BaseResultMap" type="com.resto.shop.web.model.Order" >
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="table_number" property="tableNumber" jdbcType="VARCHAR" />
    <result column="customer_count" property="customerCount" jdbcType="INTEGER" />
    <result column="accounting_time" property="accountingTime" jdbcType="DATE" />
    <result column="order_state" property="orderState" jdbcType="INTEGER" />
    <result column="production_status" property="productionStatus" jdbcType="INTEGER" />
    <result column="original_amount" property="originalAmount" jdbcType="DECIMAL" />
    <result column="reduction_amount" property="reductionAmount" jdbcType="DECIMAL" />
    <result column="payment_amount" property="paymentAmount" jdbcType="DECIMAL" />
    <result column="order_money" property="orderMoney" jdbcType="DECIMAL" />
    <result column="article_count" property="articleCount" jdbcType="INTEGER" />
    <result column="serial_number" property="serialNumber" jdbcType="VARCHAR" />
    <result column="confirm_time" property="confirmTime" jdbcType="TIMESTAMP" />
    <result column="print_times" property="printTimes" jdbcType="INTEGER" />
    <result column="allow_cancel" property="allowCancel" jdbcType="BIT" />
    <result column="allow_appraise" property="allowAppraise" jdbcType="BIT" />
    <result column="closed" property="closed" jdbcType="BIT" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="operator_id" property="operatorId" jdbcType="VARCHAR" />
    <result column="customer_id" property="customerId" jdbcType="VARCHAR" />
    <result column="distribution_date" property="distributionDate" jdbcType="DATE" />
    <result column="distribution_time_id" property="distributionTimeId" jdbcType="INTEGER" />
    <result column="delivery_point_id" property="deliveryPointId" jdbcType="INTEGER" />
    <result column="shop_detail_id" property="shopDetailId" jdbcType="VARCHAR" />
    <result column="distribution_mode_id" property="distributionModeId" jdbcType="INTEGER" />
    <result column="ver_code" property="verCode" jdbcType="VARCHAR" />
    <result column="push_order_time" property="pushOrderTime" jdbcType="TIMESTAMP" />
    <result column="print_order_time" property="printOrderTime" jdbcType="TIMESTAMP" />
    <result column="call_number_time" property="callNumberTime" jdbcType="TIMESTAMP" />
    <result column="order_mode" property="orderMode" jdbcType="INTEGER" />
    <result column="brand_id" property="brandId" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, table_number, customer_count, accounting_time, order_state, production_status, 
    original_amount, reduction_amount, payment_amount, order_money, article_count, serial_number, 
    confirm_time, print_times, allow_cancel, allow_appraise, closed, remark, create_time, 
    operator_id, customer_id, distribution_date, distribution_time_id, delivery_point_id, 
    shop_detail_id, distribution_mode_id, ver_code, push_order_time, print_order_time, 
    call_number_time, order_mode, brand_id
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from tb_order
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from tb_order
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.resto.shop.web.model.Order" >
    insert into tb_order (id, table_number, customer_count, 
      accounting_time, order_state, production_status, 
      original_amount, reduction_amount, payment_amount, 
      order_money, article_count, serial_number, 
      confirm_time, print_times, allow_cancel, 
      allow_appraise, closed, remark, 
      create_time, operator_id, customer_id, 
      distribution_date, distribution_time_id, delivery_point_id, 
      shop_detail_id, distribution_mode_id, ver_code, 
      push_order_time, print_order_time, call_number_time, 
      order_mode, brand_id)
    values (#{id,jdbcType=VARCHAR}, #{tableNumber,jdbcType=VARCHAR}, #{customerCount,jdbcType=INTEGER}, 
      #{accountingTime,jdbcType=DATE}, #{orderState,jdbcType=INTEGER}, #{productionStatus,jdbcType=INTEGER}, 
      #{originalAmount,jdbcType=DECIMAL}, #{reductionAmount,jdbcType=DECIMAL}, #{paymentAmount,jdbcType=DECIMAL}, 
      #{orderMoney,jdbcType=DECIMAL}, #{articleCount,jdbcType=INTEGER}, #{serialNumber,jdbcType=VARCHAR}, 
      #{confirmTime,jdbcType=TIMESTAMP}, #{printTimes,jdbcType=INTEGER}, #{allowCancel,jdbcType=BIT}, 
      #{allowAppraise,jdbcType=BIT}, #{closed,jdbcType=BIT}, #{remark,jdbcType=VARCHAR}, 
      #{createTime,jdbcType=TIMESTAMP}, #{operatorId,jdbcType=VARCHAR}, #{customerId,jdbcType=VARCHAR}, 
      #{distributionDate,jdbcType=DATE}, #{distributionTimeId,jdbcType=INTEGER}, #{deliveryPointId,jdbcType=INTEGER}, 
      #{shopDetailId,jdbcType=VARCHAR}, #{distributionModeId,jdbcType=INTEGER}, #{verCode,jdbcType=VARCHAR}, 
      #{pushOrderTime,jdbcType=TIMESTAMP}, #{printOrderTime,jdbcType=TIMESTAMP}, #{callNumberTime,jdbcType=TIMESTAMP}, 
      #{orderMode,jdbcType=INTEGER}, #{brandId,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.resto.shop.web.model.Order" >
    insert into tb_order
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="tableNumber != null" >
        table_number,
      </if>
      <if test="customerCount != null" >
        customer_count,
      </if>
      <if test="accountingTime != null" >
        accounting_time,
      </if>
      <if test="orderState != null" >
        order_state,
      </if>
      <if test="productionStatus != null" >
        production_status,
      </if>
      <if test="originalAmount != null" >
        original_amount,
      </if>
      <if test="reductionAmount != null" >
        reduction_amount,
      </if>
      <if test="paymentAmount != null" >
        payment_amount,
      </if>
      <if test="orderMoney != null" >
        order_money,
      </if>
      <if test="articleCount != null" >
        article_count,
      </if>
      <if test="serialNumber != null" >
        serial_number,
      </if>
      <if test="confirmTime != null" >
        confirm_time,
      </if>
      <if test="printTimes != null" >
        print_times,
      </if>
      <if test="allowCancel != null" >
        allow_cancel,
      </if>
      <if test="allowAppraise != null" >
        allow_appraise,
      </if>
      <if test="closed != null" >
        closed,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="operatorId != null" >
        operator_id,
      </if>
      <if test="customerId != null" >
        customer_id,
      </if>
      <if test="distributionDate != null" >
        distribution_date,
      </if>
      <if test="distributionTimeId != null" >
        distribution_time_id,
      </if>
      <if test="deliveryPointId != null" >
        delivery_point_id,
      </if>
      <if test="shopDetailId != null" >
        shop_detail_id,
      </if>
      <if test="distributionModeId != null" >
        distribution_mode_id,
      </if>
      <if test="verCode != null" >
        ver_code,
      </if>
      <if test="pushOrderTime != null" >
        push_order_time,
      </if>
      <if test="printOrderTime != null" >
        print_order_time,
      </if>
      <if test="callNumberTime != null" >
        call_number_time,
      </if>
      <if test="orderMode != null" >
        order_mode,
      </if>
      <if test="brandId != null" >
        brand_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="tableNumber != null" >
        #{tableNumber,jdbcType=VARCHAR},
      </if>
      <if test="customerCount != null" >
        #{customerCount,jdbcType=INTEGER},
      </if>
      <if test="accountingTime != null" >
        #{accountingTime,jdbcType=DATE},
      </if>
      <if test="orderState != null" >
        #{orderState,jdbcType=INTEGER},
      </if>
      <if test="productionStatus != null" >
        #{productionStatus,jdbcType=INTEGER},
      </if>
      <if test="originalAmount != null" >
        #{originalAmount,jdbcType=DECIMAL},
      </if>
      <if test="reductionAmount != null" >
        #{reductionAmount,jdbcType=DECIMAL},
      </if>
      <if test="paymentAmount != null" >
        #{paymentAmount,jdbcType=DECIMAL},
      </if>
      <if test="orderMoney != null" >
        #{orderMoney,jdbcType=DECIMAL},
      </if>
      <if test="articleCount != null" >
        #{articleCount,jdbcType=INTEGER},
      </if>
      <if test="serialNumber != null" >
        #{serialNumber,jdbcType=VARCHAR},
      </if>
      <if test="confirmTime != null" >
        #{confirmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="printTimes != null" >
        #{printTimes,jdbcType=INTEGER},
      </if>
      <if test="allowCancel != null" >
        #{allowCancel,jdbcType=BIT},
      </if>
      <if test="allowAppraise != null" >
        #{allowAppraise,jdbcType=BIT},
      </if>
      <if test="closed != null" >
        #{closed,jdbcType=BIT},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operatorId != null" >
        #{operatorId,jdbcType=VARCHAR},
      </if>
      <if test="customerId != null" >
        #{customerId,jdbcType=VARCHAR},
      </if>
      <if test="distributionDate != null" >
        #{distributionDate,jdbcType=DATE},
      </if>
      <if test="distributionTimeId != null" >
        #{distributionTimeId,jdbcType=INTEGER},
      </if>
      <if test="deliveryPointId != null" >
        #{deliveryPointId,jdbcType=INTEGER},
      </if>
      <if test="shopDetailId != null" >
        #{shopDetailId,jdbcType=VARCHAR},
      </if>
      <if test="distributionModeId != null" >
        #{distributionModeId,jdbcType=INTEGER},
      </if>
      <if test="verCode != null" >
        #{verCode,jdbcType=VARCHAR},
      </if>
      <if test="pushOrderTime != null" >
        #{pushOrderTime,jdbcType=TIMESTAMP},
      </if>
      <if test="printOrderTime != null" >
        #{printOrderTime,jdbcType=TIMESTAMP},
      </if>
      <if test="callNumberTime != null" >
        #{callNumberTime,jdbcType=TIMESTAMP},
      </if>
      <if test="orderMode != null" >
        #{orderMode,jdbcType=INTEGER},
      </if>
      <if test="brandId != null" >
        #{brandId,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.resto.shop.web.model.Order" >
    update tb_order
    <set >
      <if test="tableNumber != null" >
        table_number = #{tableNumber,jdbcType=VARCHAR},
      </if>
      <if test="customerCount != null" >
        customer_count = #{customerCount,jdbcType=INTEGER},
      </if>
      <if test="accountingTime != null" >
        accounting_time = #{accountingTime,jdbcType=DATE},
      </if>
      <if test="orderState != null" >
        order_state = #{orderState,jdbcType=INTEGER},
      </if>
      <if test="productionStatus != null" >
        production_status = #{productionStatus,jdbcType=INTEGER},
      </if>
      <if test="originalAmount != null" >
        original_amount = #{originalAmount,jdbcType=DECIMAL},
      </if>
      <if test="reductionAmount != null" >
        reduction_amount = #{reductionAmount,jdbcType=DECIMAL},
      </if>
      <if test="paymentAmount != null" >
        payment_amount = #{paymentAmount,jdbcType=DECIMAL},
      </if>
      <if test="orderMoney != null" >
        order_money = #{orderMoney,jdbcType=DECIMAL},
      </if>
      <if test="articleCount != null" >
        article_count = #{articleCount,jdbcType=INTEGER},
      </if>
      <if test="serialNumber != null" >
        serial_number = #{serialNumber,jdbcType=VARCHAR},
      </if>
      <if test="confirmTime != null" >
        confirm_time = #{confirmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="printTimes != null" >
        print_times = #{printTimes,jdbcType=INTEGER},
      </if>
      <if test="allowCancel != null" >
        allow_cancel = #{allowCancel,jdbcType=BIT},
      </if>
      <if test="allowAppraise != null" >
        allow_appraise = #{allowAppraise,jdbcType=BIT},
      </if>
      <if test="closed != null" >
        closed = #{closed,jdbcType=BIT},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operatorId != null" >
        operator_id = #{operatorId,jdbcType=VARCHAR},
      </if>
      <if test="customerId != null" >
        customer_id = #{customerId,jdbcType=VARCHAR},
      </if>
      <if test="distributionDate != null" >
        distribution_date = #{distributionDate,jdbcType=DATE},
      </if>
      <if test="distributionTimeId != null" >
        distribution_time_id = #{distributionTimeId,jdbcType=INTEGER},
      </if>
      <if test="deliveryPointId != null" >
        delivery_point_id = #{deliveryPointId,jdbcType=INTEGER},
      </if>
      <if test="shopDetailId != null" >
        shop_detail_id = #{shopDetailId,jdbcType=VARCHAR},
      </if>
      <if test="distributionModeId != null" >
        distribution_mode_id = #{distributionModeId,jdbcType=INTEGER},
      </if>
      <if test="verCode != null" >
        ver_code = #{verCode,jdbcType=VARCHAR},
      </if>
      <if test="pushOrderTime != null" >
        push_order_time = #{pushOrderTime,jdbcType=TIMESTAMP},
      </if>
      <if test="printOrderTime != null" >
        print_order_time = #{printOrderTime,jdbcType=TIMESTAMP},
      </if>
      <if test="callNumberTime != null" >
        call_number_time = #{callNumberTime,jdbcType=TIMESTAMP},
      </if>
      <if test="orderMode != null" >
        order_mode = #{orderMode,jdbcType=INTEGER},
      </if>
      <if test="brandId != null" >
        brand_id = #{brandId,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.resto.shop.web.model.Order" >
    update tb_order
    set table_number = #{tableNumber,jdbcType=VARCHAR},
      customer_count = #{customerCount,jdbcType=INTEGER},
      accounting_time = #{accountingTime,jdbcType=DATE},
      order_state = #{orderState,jdbcType=INTEGER},
      production_status = #{productionStatus,jdbcType=INTEGER},
      original_amount = #{originalAmount,jdbcType=DECIMAL},
      reduction_amount = #{reductionAmount,jdbcType=DECIMAL},
      payment_amount = #{paymentAmount,jdbcType=DECIMAL},
      order_money = #{orderMoney,jdbcType=DECIMAL},
      article_count = #{articleCount,jdbcType=INTEGER},
      serial_number = #{serialNumber,jdbcType=VARCHAR},
      confirm_time = #{confirmTime,jdbcType=TIMESTAMP},
      print_times = #{printTimes,jdbcType=INTEGER},
      allow_cancel = #{allowCancel,jdbcType=BIT},
      allow_appraise = #{allowAppraise,jdbcType=BIT},
      closed = #{closed,jdbcType=BIT},
      remark = #{remark,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      operator_id = #{operatorId,jdbcType=VARCHAR},
      customer_id = #{customerId,jdbcType=VARCHAR},
      distribution_date = #{distributionDate,jdbcType=DATE},
      distribution_time_id = #{distributionTimeId,jdbcType=INTEGER},
      delivery_point_id = #{deliveryPointId,jdbcType=INTEGER},
      shop_detail_id = #{shopDetailId,jdbcType=VARCHAR},
      distribution_mode_id = #{distributionModeId,jdbcType=INTEGER},
      ver_code = #{verCode,jdbcType=VARCHAR},
      push_order_time = #{pushOrderTime,jdbcType=TIMESTAMP},
      print_order_time = #{printOrderTime,jdbcType=TIMESTAMP},
      call_number_time = #{callNumberTime,jdbcType=TIMESTAMP},
      order_mode = #{orderMode,jdbcType=INTEGER},
      brand_id = #{brandId,jdbcType=VARCHAR}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
  
  <select id="selectList" resultType="Order">select * from tb_order</select>
  
  <!-- 根据 店铺ID 和 用户ID  分页查询订单列表 -->
  <select id="orderList" resultType="Order">
  	SELECT * from tb_order where shop_detail_id = #{shopId} and customer_id = #{customerId}
  	<if test="orderState != null and orderState != '' ">
  		and ORDER_STATE in 
		<foreach collection="orderState" item="state" open="(" separator="," close=")">
			#{state}
		</foreach>
  	</if>
  	 ORDER BY create_time DESC LIMIT #{start},#{datalength}
  </select>
  
  <!-- 根据订单查询 订单状态 和 生产状态 -->
  <select id="selectOrderStatesById" resultType="Order">
  	SELECT id,order_state,production_status from tb_order where id = #{orderId}
  </select>
  
  <!-- 查询  用户的新订单,如果 订单ID有值。则查询订单的详情 -->
  <select id="findCustomerNewOrder" resultType="Order">
	SELECT * from tb_order
	<if test="orderId == null or orderId == '' ">
		where customer_id=#{customerId} and shop_detail_id=#{shopId} and create_time > #{beginDate}
		and order_state in  
		<foreach collection="orderState" item="state" open="(" separator="," close=")">
			#{state}
		</foreach>
		ORDER BY create_time DESC LIMIT 0,1
	</if>
 	<if test="orderId != null and orderId != '' ">
		where id=#{orderId}
	</if>
  </select>
  <select id="selectShopOrderByDateAndProductionStates" resultType="Order">
  	select * from tb_order
  	where shop_detail_id=#{shopId} and create_time>#{date} and production_status in
  	<foreach collection="proStatus" item="state" open="(" separator="," close=")">
  		#{state}
  	</foreach>
  	and closed=0
  </select>
  
  <select id="selectHistoryOrderList" resultType="Order">
  	SELECT
		push_order_time,
		id,
		ver_code,
		article_count
		FROM
		tb_order 
		WHERE
		shop_detail_id=#{shopId}
		AND
		<![CDATA[ push_order_time>#{dateBegin} AND push_order_time<#{dateEnd}]]>
		and closed=0
		order by push_order_time DESC;
  </select>
  
  <update id="clearPushOrder" >
  	update tb_order set push_order_time=(NULL),production_status =#{1} where id=#{0} 
  </update>
  <update id="setOrderNumber" >
  	update tb_order set table_number=#{1} where id=#{0}
  </update>
  
  <!-- 根据取餐码查询已支付的订单 -->
  <select id="selectOrderByVercode" resultType="Order">
  	SELECT id,order_state,production_status,article_count,create_time,serial_number,order_money from tb_order 
  	where order_state = 2 and production_status=0 and shop_detail_id = #{shopId} and ver_code = #{vercode}
  	 ORDER BY push_order_time DESC
  </select>
  
  <!-- 根据桌号查询已支付的订单 -->
  <select id="selectOrderByTableNumber" resultType="Order">
  	SELECT id,order_state,production_status,article_count,create_time,serial_number,order_money from tb_order 
  	where order_state = 2 and production_status=0 and shop_detail_id = #{shopId} and table_number = #{tableNumber}
  	 ORDER BY push_order_time DESC
  </select>
  
</mapper>




